üó∫Ô∏è 1. Choose a geological dataset (via WMS/REST)
Use GNS Science QMAP 1:250k for Canterbury‚Äîoffered via ArcGIS WMS/REST on CanterburyMaps‚Äîcovers geological units statewide 
portal.zero.govt.nz
+1
tandfonline.com
+1
ags.aer.ca
+11
canterburymaps.govt.nz
+11
gis.gns.cri.nz
+11
.

Service URL example:

ruby
Copy
Edit
https://gis.canterburymaps.govt.nz/arcgis/rest/services/Geology/GNS_QMAP_250k/MapServer
Alternatively, for Christchurch-area details use the Eastern Canterbury geomorphology WMS 
gis.gns.cri.nz
+1
researchgate.net
+1
.

üß© 2. Integrate geology layer into Leaflet
js
Copy
Edit
const geologyLayer = L.tileLayer.wms( 
  "https://gis.canterburymaps.govt.nz/arcgis/services/Geology/GNS_QMAP_250k/MapServer/WMSServer", {
    layers: "geology_units",
    format: "image/png",
    transparent: true,
    attribution: "GNS Science - CC BY 3.0 NZ"
}).addTo(map);
üéØ 3. Identify sedimentary unit codes
Query the service‚Äôs metadata (MapServer?f=pjson) to enumerate geological primitives‚Äîpick codes for sedimentary rocks (e.g., gravels, sands, alluvium).

üîç 4. Use Leaflet WMS GetFeatureInfo
On map click, fetch geology attributes:

js
Copy
Edit
map.on("click", (e) => {
  const url = geologyLayer.getFeatureInfoUrl(
    e.latlng, map.getZoom(), map.getSize(), { info_format: 'application/json' }
  );
  fetch(url)
    .then(res => res.json())
    .then(data => {
      const unit = data.features[0]?.properties.UNIT_CODE;
      if (sedimentaryCodes.includes(unit)) {
        plotInterpolant();  // allow heatmap
      } else {
        clearInterpolant(); // block hard rock
      }
    });
});
üñºÔ∏è 5. Mask interpolant using filter
If using leaflet-heat, apply:

js
Copy
Edit
heatLayer.setOptions({
  filter: (p) => isSedimentary(p.unit_code)
});
Or preprocess your raster: set nodata where geology != sedimentary.

üåê 6. Automate zonal masking
Use client-side Turf.js or a server endpoint:

Download geological vector polygons (GeoJSON) from REST query.

Use Turf.js to clip your interpolant area to sedimentary polygons:

js
Copy
Edit
const masked = turf.mask(interpolant, geologyPolygon);
üîç 7. Data sources summary
Primary: GNS Science QMAP WMS (ArcGIS REST/WMS) ‚Äì sedimentary vs hard‚Äërock units 
ags.aer.ca
+8
gns.cri.nz
+8
gis.gns.cri.nz
+8

Detailed geology for urban Christchurch: Urban geomorphology WMS 
gns.cri.nz
+2
gis.gns.cri.nz
+2
researchgate.net
+2

Hydrogeology context: Canterbury Plains aquifer distribution maps 
gns.cri.nz
+15
researchgate.net
+15
portal.zero.govt.nz
+15

‚úÖ 8. Summary checklist for Repl.it implementation
Task	Example
Load WMS geology layer	L.tileLayer.wms(...)
Retrieve unit codes list	Query MapServer?f=pjson
Handle click-based unit detection	Use getFeatureInfo
Filter/clip interpolant	With Leaflet filter or Turf.js
Mask heatmap rendering	Hide pixels outside sedimentary zones

Once configured, your interpolant heatmap will only render in sediment-rich geological zones‚Äîensuring hard-rock areas stay blank. You can further enhance it by layering regional hydrogeology polygons (like semi-confined aquifers) to refine your yield predictions.

Would you like help writing the full code form on Repl.it or integrating buffering logic?







Sources
