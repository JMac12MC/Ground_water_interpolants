# DeepSight Architecture Diagrams

## Current System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER BROWSER                             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Streamlit UI                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚ Sidebarâ”‚  â”‚  Map   â”‚  â”‚Heatmap â”‚  â”‚ Wells  â”‚        â”‚  â”‚
â”‚  â”‚  â”‚Controlsâ”‚  â”‚ Folium â”‚  â”‚GeoJSON â”‚  â”‚Markers â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Click on map
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STREAMLIT SERVER                             â”‚
â”‚                        (app.py)                                  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Session State                                â”‚  â”‚
â”‚  â”‚  â€¢ Selected point                                         â”‚  â”‚
â”‚  â”‚  â€¢ Filtered wells                                         â”‚  â”‚
â”‚  â”‚  â€¢ Stored heatmaps                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         SYNCHRONOUS PROCESSING                            â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  1. Filter wells in radius (data_loader.py)              â”‚  â”‚
â”‚  â”‚  2. Transform to NZTM2000 (interpolation.py)             â”‚  â”‚
â”‚  â”‚  3. Run Kriging - 10-30 seconds! (PyKrige)               â”‚  â”‚
â”‚  â”‚  4. Generate grid (100m resolution)                       â”‚  â”‚
â”‚  â”‚  5. Create GeoJSON triangles (Delaunay)                  â”‚  â”‚
â”‚  â”‚  6. Store in database (database.py)                       â”‚  â”‚
â”‚  â”‚  7. Return to browser                                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  TOTAL TIME: 7-45 seconds âŒ                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      POSTGRESQL                                  â”‚
â”‚                                                                   â”‚
â”‚  â€¢ Wells data (~5000 records)                                   â”‚
â”‚  â€¢ Stored heatmaps (GeoJSON blobs)                             â”‚
â”‚  â€¢ Polygons (soil drainage, exclusion zones)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PROBLEMS:
âŒ 7-45 second response time (target: <1.5s)
âŒ Synchronous blocking computation
âŒ No caching or CDN
âŒ Cannot handle concurrent users
âŒ Full rasters sent to browser (not tiles)
```

---

## Target Architecture (Phase 3 Complete)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER BROWSER                             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Next.js Application                          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  MapLibre  â”‚    â”‚   deck.gl  â”‚    â”‚   React    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚     GL     â”‚    â”‚ (scientificâ”‚    â”‚ Components â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  (tiles)   â”‚    â”‚  layers)   â”‚    â”‚ (controls) â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Features:                                                â”‚  â”‚
â”‚  â”‚  â€¢ Viewport-based tile fetching                          â”‚  â”‚
â”‚  â”‚  â€¢ Request cancellation on pan/zoom                      â”‚  â”‚
â”‚  â”‚  â€¢ Bounded LRU tile cache                                â”‚  â”‚
â”‚  â”‚  â€¢ Progressive refinement                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                              â”‚
           â”‚ Fetch tiles                  â”‚ Click-to-evaluate
           â”‚ <200ms âœ…                   â”‚ <500ms âœ…
           â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CDN (CloudFront)   â”‚         â”‚   QUERY SERVICE      â”‚
â”‚                      â”‚         â”‚     (FastAPI)        â”‚
â”‚  â€¢ Tile caching      â”‚         â”‚                      â”‚
â”‚  â€¢ Global edge nodes â”‚         â”‚  â€¢ Point evaluation  â”‚
â”‚  â€¢ CORS enabled      â”‚         â”‚  â€¢ Nearby wells      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â€¢ Uncertainty data  â”‚
           â”‚                      â”‚  â€¢ Redis caching     â”‚
           â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚   TILE SERVICE       â”‚                    â”‚
â”‚     (FastAPI)        â”‚                    â”‚
â”‚                      â”‚                    â”‚
â”‚  GET /tiles/{layer}/ â”‚                    â”‚
â”‚    {version}/{z}/    â”‚                    â”‚
â”‚    {x}/{y}.png       â”‚                    â”‚
â”‚                      â”‚                    â”‚
â”‚  â€¢ Version routing   â”‚                    â”‚
â”‚  â€¢ Cache headers     â”‚                    â”‚
â”‚  â€¢ Metadata API      â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
           â”‚                                 â”‚
           â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STORAGE LAYER                                 â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Object Storage   â”‚  â”‚   PostgreSQL      â”‚  â”‚    Redis     â”‚â”‚
â”‚  â”‚  (S3 / MinIO)     â”‚  â”‚   + PostGIS       â”‚  â”‚   (Cache)    â”‚â”‚
â”‚  â”‚                   â”‚  â”‚                   â”‚  â”‚              â”‚â”‚
â”‚  â”‚  Tile Storage:    â”‚  â”‚  Well Data:       â”‚  â”‚  Hot Cache:  â”‚â”‚
â”‚  â”‚  â€¢ tiles/yield/   â”‚  â”‚  â€¢ Wells table    â”‚  â”‚  â€¢ Queries   â”‚â”‚
â”‚  â”‚    {version}/     â”‚  â”‚  â€¢ Metadata       â”‚  â”‚  â€¢ Tiles     â”‚â”‚
â”‚  â”‚    {z}/{x}/{y}    â”‚  â”‚  â€¢ Geometry       â”‚  â”‚  â€¢ Results   â”‚â”‚
â”‚  â”‚  â€¢ Versioned      â”‚  â”‚  â€¢ Provenance     â”‚  â”‚              â”‚â”‚
â”‚  â”‚  â€¢ Immutable      â”‚  â”‚  â€¢ Spatial index  â”‚  â”‚  LRU evictionâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
                    Tiles generated by
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  OFFLINE COMPUTE PIPELINE                        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Job Queue (Celery + Redis)                   â”‚  â”‚
â”‚  â”‚  â€¢ Process new well data                                  â”‚  â”‚
â”‚  â”‚  â€¢ Retrain models                                         â”‚  â”‚
â”‚  â”‚  â€¢ Generate tiles for updated regions                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Batch Tile Generation                           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  1. Load well data from database                          â”‚  â”‚
â”‚  â”‚  2. Filter by region/zone                                 â”‚  â”‚
â”‚  â”‚  3. Transform to NZTM2000                                 â”‚  â”‚
â”‚  â”‚  4. Fit interpolation model (per zone)                    â”‚  â”‚
â”‚  â”‚  5. Generate 100m Ã— 100m grid                             â”‚  â”‚
â”‚  â”‚  6. Predict on grid                                       â”‚  â”‚
â”‚  â”‚  7. Cut into z/x/y tiles (zoom 10-16)                    â”‚  â”‚
â”‚  â”‚  8. Store tiles in object storage                         â”‚  â”‚
â”‚  â”‚  9. Update metadata database                              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Runs OFFLINE - does not block users âœ…                  â”‚  â”‚
â”‚  â”‚  Monte Carlo uncertainty propagation âœ…                   â”‚  â”‚
â”‚  â”‚  Full provenance tracking âœ…                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BENEFITS:
âœ… <1.5s initial map load (tiles served from CDN)
âœ… <500ms click-to-evaluate (pre-computed, cached queries)
âœ… 100+ concurrent users (stateless, scalable)
âœ… Country-scale datasets (50k+ wells supported)
âœ… Uncertainty as first-class output
âœ… Version control and rollback capability
```

---

## Data Flow Comparison

### Current System
```
User Click
    â†“ (0ms)
Filter Wells
    â†“ (500ms)
Transform Coordinates
    â†“ (100ms)
Run Kriging â† BOTTLENECK!
    â†“ (10-30 seconds)
Generate GeoJSON
    â†“ (1-5 seconds)
Render in Browser
    â†“ (1-10 seconds)
Display Map
    â†“
TOTAL: 7-45 seconds âŒ
```

### Target System
```
User Loads Page
    â†“ (0ms)
Fetch Tiles from CDN â† PRE-COMPUTED!
    â†“ (<200ms per tile)
Render Tiles in MapLibre
    â†“ (<500ms)
Display Map
    â†“
TOTAL: <1.5 seconds âœ…

User Clicks on Map
    â†“ (0ms)
Query Pre-computed Grid â† NO KRIGING!
    â†“ (<100ms from Redis cache)
    â†“ (<500ms from database)
Fetch Nearby Wells
    â†“ (<100ms spatial index)
Return Results
    â†“
TOTAL: <500ms âœ…
```

---

## Tile Generation Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TILE GENERATION WORKFLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: LOAD WELL DATA
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load from Database     â”‚
â”‚  â€¢ Filter by region     â”‚
â”‚  â€¢ Quality checks       â”‚
â”‚  â€¢ 50,000 wells         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
Step 2: GRID GENERATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create 100m Grid      â”‚
â”‚  â€¢ NZTM2000 CRS        â”‚
â”‚  â€¢ True metric spacing â”‚
â”‚  â€¢ Regular grid        â”‚
â”‚  â€¢ ~500,000 points     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
Step 3: INTERPOLATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fit Kriging Model     â”‚
â”‚  â€¢ Per zone/aquifer    â”‚
â”‚  â€¢ Variogram fitting   â”‚
â”‚  â€¢ Predict on grid     â”‚
â”‚  â€¢ Uncertainty (ÏƒÂ²)    â”‚
â”‚  â€¢ ~2-5 minutes        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
Step 4: TILE CUTTING
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate Tiles        â”‚
â”‚  â€¢ Zoom 10 (regional)  â”‚
â”‚  â€¢ Zoom 14 (detail)    â”‚
â”‚  â€¢ 256Ã—256 PNG         â”‚
â”‚  â€¢ ~1000 tiles         â”‚
â”‚  â€¢ ~30 seconds         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
Step 5: STORAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Store in S3           â”‚
â”‚  â€¢ Versioned path      â”‚
â”‚  â€¢ Metadata JSON       â”‚
â”‚  â€¢ Provenance tracking â”‚
â”‚  â€¢ Immutable           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
Step 6: DEPLOYMENT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Publish to CDN        â”‚
â”‚  â€¢ Update version      â”‚
â”‚  â€¢ Invalidate cache    â”‚
â”‚  â€¢ A/B testing         â”‚
â”‚  â€¢ Rollback ready      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL PIPELINE TIME: ~5-10 minutes
RUN FREQUENCY: On data update (weekly/monthly)
COST: Precompute once, serve millions of times âœ…
```

---

## Migration Path (Phased Approach)

```
CURRENT STATE                 PHASE 1                PHASE 2                PHASE 3 (TARGET)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Streamlit â”‚                â”‚Streamlit â”‚           â”‚Streamlit â”‚            â”‚ Next.js  â”‚
â”‚   App    â”‚                â”‚   App    â”‚           â”‚   App    â”‚            â”‚   App    â”‚
â”‚          â”‚                â”‚          â”‚           â”‚ (tiles)  â”‚            â”‚ (tiles)  â”‚
â”‚(GeoJSON) â”‚                â”‚(GeoJSON) â”‚           â”‚          â”‚            â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                           â”‚                       â”‚                       â”‚
     â–¼                           â”‚                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚On-demand â”‚                    â”‚                  â”‚  Tile    â”‚            â”‚  Tile    â”‚
â”‚ Kriging  â”‚                    â”‚                  â”‚  Server  â”‚            â”‚  Server  â”‚
â”‚(7-45s)   â”‚                    â”‚                  â”‚(FastAPI) â”‚            â”‚(FastAPI) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚                       â”‚
                                â–¼                       â–¼                       â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Batch   â”‚            â”‚  Batch   â”‚            â”‚  Batch   â”‚
                         â”‚  Tile    â”‚            â”‚  Tile    â”‚            â”‚  Tile    â”‚
                         â”‚Generator â”‚ â”€â”€â”€runsâ”€â”€â–¶ â”‚Generator â”‚            â”‚Generator â”‚
                         â”‚(parallel)â”‚            â”‚(full)    â”‚            â”‚(async)   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                       â”‚                       â”‚
                              â–¼                       â–¼                       â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Tiles/   â”‚            â”‚ Tiles/   â”‚            â”‚ Object   â”‚
                         â”‚ Files    â”‚            â”‚ Files    â”‚            â”‚ Storage  â”‚
                         â”‚          â”‚            â”‚ + Redis  â”‚            â”‚ + Redis  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ + CDN    â”‚
                                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Weeks 0-4                Weeks 5-8              Weeks 9-16
Working prototype        Hybrid system          Production system
7-45s response          <1.5s initial load     <500ms queries
GeoJSON rendering       Tile rendering         Full tile system
No caching              Redis caching          CDN + Redis
                        
VALIDATE âœ“              VALIDATE âœ“             DEPLOY âœ“
Keep old system         Run parallel           Deprecate old
Build in parallel       A/B testing            Full migration
```

---

## Performance Improvement Timeline

```
Response Time (seconds)
   50â”‚
     â”‚ â”Œâ”€â”€â”
   40â”‚ â”‚  â”‚  Current: On-demand Kriging
     â”‚ â”‚  â”‚  
   30â”‚ â”‚  â”‚  
     â”‚ â”‚  â”‚  
   20â”‚ â”‚  â”‚  
     â”‚ â”‚  â”‚  
   10â”‚â”Œâ”´â”€â”€â”´â”                              
     â”‚â”‚ Avgâ”‚                              
    7â”‚â””â”€â”€â”€â”€â”˜                              
     â”‚                                    
    5â”‚                                    
     â”‚                                    
    3â”‚        â”Œâ”€â”€â”€â”€â”                     
     â”‚        â”‚Phaseâ”‚ Phase 2: Tile serving
    1.5â”‚      â”‚  1  â”‚ â”Œâ”€â”€â”€â”  Target! âœ…
     â”‚        â””â”€â”€â”€â”€â”˜ â”‚   â”‚  
    1â”‚                â””â”€â”€â”€â”˜              
     â”‚                                    
  0.5â”‚                      â”Œâ”€â”€â” Phase 3: Full system
     â”‚                      â”‚  â”‚ Click-to-evaluate âœ…
    0â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
      Now    Week 4    Week 8         Week 16
      
  âŒ Current: 7-45s average (unacceptable)
  ğŸŸ¡ Phase 1: Foundation built (no user impact yet)
  ğŸŸ¢ Phase 2: <1.5s initial load (HUGE improvement!)
  âœ… Phase 3: <500ms queries (production ready!)
```

---

## Cost-Benefit Analysis

### Current System Costs
```
Operation: Click on map â†’ generate heatmap
Time: 7-45 seconds
Server cost: $0.10 per computation (estimate)
User cost: Frustration, abandonment

At 1000 queries/day:
â€¢ 1000 Ã— 30s avg = 8.3 hours of compute
â€¢ $100/day in server costs
â€¢ Poor user experience
```

### Target System Costs
```
Operation: Click on map â†’ fetch pre-computed tile
Time: <500ms
Server cost: $0.001 per tile fetch (cached)
User cost: None (fast response)

At 1000 queries/day:
â€¢ Pre-compute once: $50 (weekly/monthly)
â€¢ Tile serving: $10/day (mostly cached)
â€¢ CDN bandwidth: $20/day
â€¢ Total: ~$30/day
â€¢ Plus: Great user experience âœ…

SAVINGS: 70% cost reduction + 90x faster!
```

---

## Summary

**Current System:**
- Streamlit monolith with on-demand computation
- 7-45 second response times
- Cannot scale beyond single region/user
- Cost: High compute, poor experience

**Target System:**
- Tile-first architecture with offline pre-computation
- <1.5s initial load, <500ms queries
- Scales to country-wide, 100+ concurrent users
- Cost: 70% reduction, great experience

**Migration Strategy:**
- Build in parallel (no disruption)
- Validate at each phase
- Gradual cutover to new system
- Keep old system as backup

**Timeline:** 16 weeks to production
**Effort:** 2-3 developers
**Result:** Production-ready DeepSight system âœ…
