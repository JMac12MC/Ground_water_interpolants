import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from pykrige.ok import OrdinaryKriging
from sklearn.metrics import mean_squared_error

# Example well data (replace with actual data loading)
well_data = pd.read_csv('your_well_data.csv')  # Must contain 'latitude', 'longitude', 'value'

# Create a grid over the area
lat_min, lat_max = well_data['latitude'].min(), well_data['latitude'].max()
lon_min, lon_max = well_data['longitude'].min(), well_data['longitude'].max()

num_grid = 100
grid_lat = np.linspace(lat_min, lat_max, num_grid)
grid_lon = np.linspace(lon_min, lon_max, num_grid)
grid_lon, grid_lat = np.meshgrid(grid_lon, grid_lat)

# Interpolation methods to test
interpolation_methods = [
    'Kriging (Auto-Fitted Linear)',
    'Kriging (Auto-Fitted Spherical)',
    'Kriging (Auto-Fitted Gaussian)',
    'Kriging (Auto-Fitted Exponential)'
]

# Output storage for comparison
results = {}

for method in interpolation_methods:
    # Detect model type
    if 'Spherical' in method:
        model_type = 'spherical'
    elif 'Gaussian' in method:
        model_type = 'gaussian'
    elif 'Exponential' in method:
        model_type = 'exponential'
    else:
        model_type = 'linear'

    # Run Ordinary Kriging with auto-fitted model
    OK = OrdinaryKriging(
        well_data['longitude'],
        well_data['latitude'],
        well_data['value'],
        variogram_model=model_type,
        verbose=False,
        enable_plotting=False  # Set True to plot variogram
    )

    z, ss = OK.execute('grid', grid_lon[0], grid_lat[:, 0])

    # Save result
    results[method] = z

    # Optional: visualize
    plt.figure(figsize=(6, 5))
    plt.contourf(grid_lon, grid_lat, z, cmap='viridis')
    plt.colorbar(label='Interpolated Value')
    plt.scatter(well_data['longitude'], well_data['latitude'], c=well_data['value'], edgecolor='k')
    plt.title(f'{method}')
    plt.xlabel('Longitude')
    plt.ylabel('Latitude')
    plt.tight_layout()
    plt.savefig(f'{method.replace(" ", "_").replace("(", "").replace(")", "")}.png')
    plt.close()

# Compare models (optional): print variance summary or RMSE using leave-one-out
# More advanced: compute cross-validation RMSE per model if needed
